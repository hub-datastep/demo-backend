# Авто тесты

## Описание

<hr>

***test_chroma_patch_for_noms_sync.py*** - набор тестов для проверки метода `get_chroma_patch_for_sync` из
модели `synchronize_nomenclatures_model`

- Для этого метода необходимо проверить различные комбинации трех
  параметров: `root_group_name`, `is_in_vectorstore`, `is_deleted`
- Тесты проверяют создание, обновление и удаление данных в соответствии с изменениями в указанных параметрах.

<hr>

***test_nomenclatures_synchronization.py*** - набор тестов для метода `synchronize_nomenclatures`, который
отвечает за синхронизацию номенклатур в базе данных и векторсторе.

- Проверка добавления, обновления и удаления записей в векторсторе
- Проверка корректности выполнения синхронизации после изменений в базе данных

<hr>

## Структура тестов

### 1. test_chroma_patch_for_noms_sync.py :

> Этот файл содержит тесты для метода `get_chroma_patch_for_sync` из модели `synchronize_nomenclatures_model`.
> Каждый тест содержит утверждение, цель которого - проверить правильность работы метода на конкретных входных данных

1. Создание тестовых данных с различными параметрами
2. Проверка ожидаемых результатов работы метода синхронизации `get_chroma_patch_for_sync` для каждого сочетания
   параметров `root_group_name`, `is_in_vectorstore` и `is_deleted`

> Успешное прохождение всех тестов в этом файле указывает на корректную работу метода get_chroma_patch_for_sync

### 2. test_nomenclatures_synchronization.py :

> Содержит тесты для метода `synchronize_nomenclatures`. Они проверяют процесс синхронизации номенклатур между БД и
> векторстором, убеждаясь в корректности их обновления.

1. **Установка окружения:**
    - Задаются фикстуры `_db_params` и `_chroma_params`, определяющие параметры подключения к базе данных и векторстору;
    - Фикстуры для очистки и пересоздания тестовой базы данных и векторстора
      `_drop_test_nomenclature_db_table`,
      `_recreate_test_nomenclature_db_table`,
      `_drop_test_nomenclature_chroma_collection`,
      `_recreate_test_nomenclature_chroma_collection`
      готовят среду для проведения тестов.

2. **Подготовка тестовых данных:**
    - Фикстура `_create_test_noms` создает тестовые номенклатуры и группы в базе данных;
    - Фикстура `_update_test_noms` обновляет и удаляет определенные номенклатуры в базе данных.

3. **Тестирование синхронизации:**
    - Метод `_get_chroma_result` получает информацию о коллекции из Chroma;

4. **Тест 1: Создание номенклатур в векторсторе:**
    - Перед выполнением теста вызываются фикстуры для создания номенклатур в Chroma;
    - Вызывается функция `synchronize_nomenclatures` для синхронизации данных;
    - Проверяется, что созданные номенклатуры присутствуют в Chroma и имеют встроенные данные;
    - Ожидается, что количество записей в Chroma и встроенные данные соответствуют ожидаемым значениям.

5. **Тест 2: Обновление и удаление номенклатур в векторсторе:**
    - Фикстура `_update_test_noms` обновляет данные в базе данных;
    - Вызывается функция `synchronize_nomenclatures` для синхронизации данных в векторсторе;
    - Получаются данные до и после изменений для определенных номенклатур;
    - Проверяется, что данные номенклатур изменились после обновления и что удаленная номенклатура отсутствует в
      векторсторе.

> Успешное прохождение всех тестов указывает на правильность работы процесса синхронизации номенклатур
